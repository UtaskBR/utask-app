(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9528],{1841:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>i});var t=s(5155),r=s(2115),l=s(2108),o=s(5695);function i(){let{data:e,status:a}=(0,l.useSession)(),[s,i]=(0,r.useState)({name:"",about:"",city:"",state:""}),[n,c]=(0,r.useState)(""),[d,u]=(0,r.useState)([]),[m,p]=(0,r.useState)(!1),[f,h]=(0,r.useState)(""),[x,b]=(0,r.useState)([]),[g,v]=(0,r.useState)([]),[j,y]=(0,r.useState)(!0),N=(0,o.useRouter)(),w=(0,r.useRef)(null),E=(0,r.useRef)(null);(0,r.useEffect)(()=>{var s;"authenticated"===a&&(null==e||null==(s=e.user)?void 0:s.id)&&fetch("/api/users/".concat(e.user.id)).then(e=>e.json()).then(e=>{e.error?h(e.error):(i({name:e.name||"",about:e.about||"",city:e.city||"",state:e.state||""}),c(e.image||""),u(e.photos||[]),e.professions&&v(e.professions.map(e=>e.id)),e.professions&&v(e.professions.map(e=>e.id)))}).catch(e=>{h("Erro ao carregar dados do usu\xe1rio."),console.error(e)})},[a,e]),(0,r.useEffect)(()=>{fetch("/api/professions").then(e=>e.json()).then(e=>{b(e),y(!1)}).catch(e=>{console.error("Erro ao carregar profiss\xf5es:",e),y(!1)})},[]);let k=e=>{let{name:a,value:s}=e.target;i(e=>({...e,[a]:s}))},P=e=>{v(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},S=async()=>{var a;if(null==e||null==(a=e.user)?void 0:a.id)try{let a=await fetch("/api/users/".concat(e.user.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw Error("Erro ao atualizar perfil: ".concat(a.status));let t=await fetch("/api/users/".concat(e.user.id,"/professions"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({professionIds:g})});if(!t.ok)throw Error("Erro ao atualizar profiss\xf5es: ".concat(t.status));alert("Perfil atualizado com sucesso!"),N.push("/perfil/".concat(e.user.id))}catch(e){console.error("Erro ao salvar perfil:",e),e instanceof Error?alert("Falha ao atualizar perfil: ".concat(e.message)):alert("Falha ao atualizar perfil: Erro desconhecido.")}},C=async a=>{var s,t;let r=null==(s=a.target.files)?void 0:s[0];if(r&&(null==e||null==(t=e.user)?void 0:t.id)){p(!0);try{let a=URL.createObjectURL(r);c(a);let s=new FormData;s.append("upload_preset","utask-avatar"),s.append("file",r);let t=await fetch("https://api.cloudinary.com/v1_1/".concat("dhkkz3vlv","/image/upload"),{method:"POST",body:s});if(!t.ok)throw Error("Erro ao fazer upload para Cloudinary: ".concat(t.status));let l=await t.json();console.log("Resposta do Cloudinary:",l);let o=await fetch("/api/upload/avatar",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.user.id,url:l.secure_url,publicId:l.public_id})});if(!o.ok)throw Error("Erro ao atualizar avatar: ".concat(o.status));let i=await o.json();console.log("Resposta da API de avatar:",i),c(l.secure_url),w.current&&(w.current.value=""),alert("Foto de perfil atualizada com sucesso!")}catch(e){console.error("Erro ao processar upload de avatar:",e),alert("Falha ao atualizar foto de perfil. Tente novamente.")}finally{p(!1)}}},T=async a=>{var s,t;let r=null==(s=a.target.files)?void 0:s[0];if(r&&(null==e||null==(t=e.user)?void 0:t.id)){p(!0);try{let a=URL.createObjectURL(r),s={id:"temp-".concat(Date.now()),url:a,isTemp:!0};u(e=>[...e,s]);let t=new FormData;t.append("upload_preset","utask-gallery"),t.append("file",r);let l=await fetch("https://api.cloudinary.com/v1_1/".concat("dhkkz3vlv","/image/upload"),{method:"POST",body:t});if(!l.ok)throw Error("Erro ao fazer upload para Cloudinary: ".concat(l.status));let o=await l.json();console.log("Resposta do Cloudinary:",o);let i=await fetch("/api/upload/gallery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.user.id,url:o.secure_url,publicId:o.public_id})});if(!i.ok)throw Error("Erro ao adicionar foto \xe0 galeria: ".concat(i.status));let n=await i.json();console.log("Resposta da API de galeria:",n),u(e=>e.filter(e=>e.id!==s.id).concat({...n.photo,isTemp:!1})),E.current&&(E.current.value=""),alert("Foto adicionada \xe0 galeria com sucesso!")}catch(e){console.error("Erro ao processar upload para galeria:",e),alert("Falha ao adicionar foto \xe0 galeria. Tente novamente."),u(e=>e.filter(e=>!e.isTemp))}finally{p(!1)}}};return"loading"===a||j?(0,t.jsx)("div",{className:"max-w-3xl mx-auto p-6",children:"Carregando..."}):f?(0,t.jsx)("div",{className:"max-w-3xl mx-auto p-6",children:(0,t.jsx)("div",{className:"bg-red-100 text-red-800 p-4 rounded",children:f})}):(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,t.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Editar Perfil"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Nome"}),(0,t.jsx)("input",{name:"name",className:"input-field",value:s.name,onChange:k})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Sobre"}),(0,t.jsx)("textarea",{name:"about",className:"input-field",value:s.about,onChange:k})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Cidade"}),(0,t.jsx)("input",{name:"city",className:"input-field",value:s.city,onChange:k})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Estado"}),(0,t.jsx)("input",{name:"state",className:"input-field",value:s.state,onChange:k})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Profiss\xf5es"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:x.map(e=>(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"profession-".concat(e.id),checked:g.includes(e.id),onChange:()=>P(e.id),className:"mr-2"}),(0,t.jsx)("label",{htmlFor:"profession-".concat(e.id),className:"text-sm",children:e.name})]},e.id))}),0===x.length&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Nenhuma profiss\xe3o dispon\xedvel."})]}),(0,t.jsx)("button",{onClick:S,className:"btn-primary",disabled:m,children:"Salvar"}),(0,t.jsx)("hr",{className:"my-6"}),(0,t.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Foto de Perfil"}),(0,t.jsxs)("div",{className:"mb-4",children:[n&&(0,t.jsx)("img",{src:n,alt:"avatar",className:"w-24 h-24 rounded-full mb-2 object-cover"}),(0,t.jsx)("input",{ref:w,type:"file",accept:"image/*",onChange:C,disabled:m,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),m&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Enviando..."})]}),(0,t.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Galeria"}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-3 mb-4",children:d.map((e,a)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:e.url,alt:"Foto",className:"rounded-lg h-32 w-full object-cover ".concat(e.isTemp?"opacity-50":"")}),e.isTemp&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white bg-black bg-opacity-50 px-2 py-1 rounded",children:"Enviando..."})})]},e.id||a))}),(0,t.jsx)("input",{ref:E,type:"file",accept:"image/*",onChange:T,disabled:m,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),m&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Enviando..."})]})}},2823:(e,a,s)=>{Promise.resolve().then(s.bind(s,1841))},5695:(e,a,s)=>{"use strict";var t=s(8999);s.o(t,"useParams")&&s.d(a,{useParams:function(){return t.useParams}}),s.o(t,"usePathname")&&s.d(a,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(a,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(a,{useSearchParams:function(){return t.useSearchParams}})}},e=>{var a=a=>e(e.s=a);e.O(0,[2108,8441,1684,7358],()=>a(2823)),_N_E=e.O()}]);