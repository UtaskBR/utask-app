(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2788],{4285:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),r=a(2115),l=a(2108),o=a(6874),i=a.n(o),n=a(3568);function c(){let{data:e}=(0,l.useSession)(),[t,a]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[d,h]=(0,r.useState)(null),[m,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:a}=e.coords;u({lat:t,lng:a})},e=>{console.error("Erro ao obter localiza\xe7\xe3o:",e),u({lat:-15.7801,lng:-47.9292})}),(async()=>{try{let e=await fetch("/api/services?withLocation=true");if(!e.ok)throw Error("Erro ao buscar servi\xe7os");let t=await e.json();a(t)}catch(e){console.error("Erro ao buscar servi\xe7os:",e),n.Ay.error("N\xe3o foi poss\xedvel carregar os servi\xe7os")}finally{c(!1)}})()},[]);let x=t.map(e=>({lng:e.longitude,lat:e.latitude,color:"#0ea5e9",label:"â‚¹",popupContent:'\n      <div class="p-2">\n        <h3 class="font-medium">'.concat(e.title,'</h3>\n        <p class="text-sm">').concat(e.value?"R$ ".concat(e.value.toFixed(2)):"Aberto a propostas",'</p>\n        <a href="/servicos/').concat(e.id,'" class="text-blue-600 text-sm">Ver detalhes</a>\n      </div>\n    '),id:e.id})),p=(e,t,a,s)=>{let r=(a-e)*Math.PI/180,l=(s-t)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371},v=m?[...t].sort((e,t)=>e.latitude&&e.longitude?t.latitude&&t.longitude?p(m.lat,m.lng,e.latitude,e.longitude)-p(m.lat,m.lng,t.latitude,t.longitude):-1:1):t;return(0,s.jsx)("div",{className:"h-[calc(100vh-4rem)]",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 h-full",children:[(0,s.jsxs)("div",{className:"lg:col-span-1 bg-white p-4 overflow-y-auto border-r border-secondary-200",children:[(0,s.jsx)("h1",{className:"text-xl font-bold text-secondary-900 mb-4",children:"Servi\xe7os no Mapa"}),o?(0,s.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,s.jsx)("p",{children:"Carregando servi\xe7os..."})}):0===v.length?(0,s.jsx)("div",{className:"bg-secondary-50 rounded-lg p-4 text-center",children:(0,s.jsx)("p",{className:"text-secondary-600",children:"Nenhum servi\xe7o com localiza\xe7\xe3o encontrado."})}):(0,s.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,s.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat((null==d?void 0:d.id)===e.id?"border-primary-500 bg-primary-50":"border-secondary-200 hover:border-primary-300"),onClick:()=>h(e),children:[(0,s.jsx)("h3",{className:"font-medium text-secondary-900",children:e.title}),e.value?(0,s.jsxs)("p",{className:"text-primary-600 font-bold mt-1",children:["R$ ",e.value.toFixed(2)]}):(0,s.jsx)("p",{className:"text-secondary-600 text-sm mt-1",children:"Aberto a propostas"}),(0,s.jsx)("p",{className:"text-secondary-600 text-sm mt-2 line-clamp-2",children:e.description}),m&&e.latitude&&e.longitude&&(0,s.jsxs)("p",{className:"text-secondary-500 text-xs mt-2",children:["Dist\xe2ncia: ",p(m.lat,m.lng,e.latitude,e.longitude).toFixed(1)," km"]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(i(),{href:"/servicos/".concat(e.id),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:"Ver detalhes"})})]},e.id))})]}),(0,s.jsxs)("div",{className:"lg:col-span-3 relative",children:[(0,s.jsx)(MapComponent,{initialLocation:m||{lng:-47.9292,lat:-15.7801},markers:x,height:"100%",interactive:!0,zoom:12}),o&&(0,s.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-white py-2 px-4 rounded-full shadow-md",children:(0,s.jsx)("p",{className:"text-secondary-600",children:"Carregando servi\xe7os..."})})]})]})})}},8238:(e,t,a)=>{Promise.resolve().then(a.bind(a,4285))}},e=>{var t=t=>e(e.s=t);e.O(0,[2108,6874,3568,8441,1684,7358],()=>t(8238)),_N_E=e.O()}]);