(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2788],{2853:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>p});var r=a(5155),s=a(2115),l=a(2108),o=a(6874),n=a.n(o),c=a(3568),i=a(5411),d=a.n(i);a(8689);var u=a(1018),h=a.n(u);function m(e){let{initialLocation:t={lng:-47.9292,lat:-15.7801},markers:a=[],onLocationSelect:l,height:o="400px",interactive:n=!0,zoom:c=12}=e,i=(0,s.useRef)(null),u=(0,s.useRef)(null),[m,p]=(0,s.useState)(!1),[x,g]=(0,s.useState)(t);return(0,s.useEffect)(()=>{if(i.current&&!u.current){if(u.current=new(d()).Map({container:i.current,style:"mapbox://styles/mapbox/streets-v11",center:[t.lng,t.lat],zoom:c,interactive:n}),u.current.addControl(new(d()).NavigationControl,"top-right"),n){let e=new(h())({accessToken:d().accessToken||"",mapboxgl:d(),placeholder:"Buscar endere\xe7o",language:"pt-BR",countries:"br"});u.current.addControl(e,"top-left"),e.on("result",e=>{let{center:t,place_name:a}=e.result,r={lng:t[0],lat:t[1],address:a};g(r),l&&l(r)})}return n&&l&&u.current.on("click",e=>{let{lng:t,lat:a}=e.lngLat;fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t,",").concat(a,".json?access_token=").concat(d().accessToken,"&language=pt-BR")).then(e=>e.json()).then(e=>{var r;let s={lng:t,lat:a,address:(null==(r=e.features[0])?void 0:r.place_name)||""};g(s),l(s)})}),u.current.on("load",()=>{p(!0)}),()=>{u.current&&(u.current.remove(),u.current=null)}}},[t,n,l,c]),(0,s.useEffect)(()=>{m&&u.current&&(document.querySelectorAll(".mapboxgl-marker").forEach(e=>e.remove()),x&&new(d()).Marker({color:"#0ea5e9"}).setLngLat([x.lng,x.lat]).addTo(u.current),a.forEach(e=>{if(!e.lng||!e.lat)return;let t=document.createElement("div");t.className="custom-marker",t.style.width="30px",t.style.height="30px",t.style.borderRadius="50%",t.style.backgroundColor=e.color||"#f59e0b",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.color="white",t.style.fontWeight="bold",t.style.cursor="pointer",t.innerText=e.label||"";let a=new(d()).Marker(t).setLngLat([e.lng,e.lat]).addTo(u.current);if(e.popupContent){let t=new(d()).Popup({offset:25}).setHTML(e.popupContent);a.setPopup(t)}}))},[m,a,x]),(0,r.jsx)("div",{ref:i,style:{width:"100%",height:o},className:"rounded-lg overflow-hidden"})}function p(){let{data:e}=(0,l.useSession)(),[t,a]=(0,s.useState)([]),[o,i]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[h,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:a}=e.coords;p({lat:t,lng:a})},e=>{console.error("Erro ao obter localiza\xe7\xe3o:",e),p({lat:-15.7801,lng:-47.9292})}),(async()=>{try{let e=await fetch("/api/services?withLocation=true");if(!e.ok)throw Error("Erro ao buscar servi\xe7os");let t=await e.json();a(t)}catch(e){console.error("Erro ao buscar servi\xe7os:",e),c.Ay.error("N\xe3o foi poss\xedvel carregar os servi\xe7os")}finally{i(!1)}})()},[]);let x=t.map(e=>({lng:e.longitude,lat:e.latitude,color:"#0ea5e9",label:"â‚¹",popupContent:'\n      <div class="p-2">\n        <h3 class="font-medium">'.concat(e.title,'</h3>\n        <p class="text-sm">').concat(e.value?"R$ ".concat(e.value.toFixed(2)):"Aberto a propostas",'</p>\n        <a href="/servicos/').concat(e.id,'" class="text-blue-600 text-sm">Ver detalhes</a>\n      </div>\n    '),id:e.id})),g=(e,t,a,r)=>{let s=(a-e)*Math.PI/180,l=(r-t)*Math.PI/180,o=Math.sin(s/2)*Math.sin(s/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371},v=h?[...t].sort((e,t)=>e.latitude&&e.longitude?t.latitude&&t.longitude?g(h.lat,h.lng,e.latitude,e.longitude)-g(h.lat,h.lng,t.latitude,t.longitude):-1:1):t;return(0,r.jsx)("div",{className:"h-[calc(100vh-4rem)]",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 h-full",children:[(0,r.jsxs)("div",{className:"lg:col-span-1 bg-white p-4 overflow-y-auto border-r border-secondary-200",children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-secondary-900 mb-4",children:"Servi\xe7os no Mapa"}),o?(0,r.jsx)("div",{className:"flex justify-center items-center h-32",children:(0,r.jsx)("p",{children:"Carregando servi\xe7os..."})}):0===v.length?(0,r.jsx)("div",{className:"bg-secondary-50 rounded-lg p-4 text-center",children:(0,r.jsx)("p",{className:"text-secondary-600",children:"Nenhum servi\xe7o com localiza\xe7\xe3o encontrado."})}):(0,r.jsx)("div",{className:"space-y-4",children:v.map(e=>(0,r.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat((null==d?void 0:d.id)===e.id?"border-primary-500 bg-primary-50":"border-secondary-200 hover:border-primary-300"),onClick:()=>u(e),children:[(0,r.jsx)("h3",{className:"font-medium text-secondary-900",children:e.title}),e.value?(0,r.jsxs)("p",{className:"text-primary-600 font-bold mt-1",children:["R$ ",e.value.toFixed(2)]}):(0,r.jsx)("p",{className:"text-secondary-600 text-sm mt-1",children:"Aberto a propostas"}),(0,r.jsx)("p",{className:"text-secondary-600 text-sm mt-2 line-clamp-2",children:e.description}),h&&e.latitude&&e.longitude&&(0,r.jsxs)("p",{className:"text-secondary-500 text-xs mt-2",children:["Dist\xe2ncia: ",g(h.lat,h.lng,e.latitude,e.longitude).toFixed(1)," km"]}),(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)(n(),{href:"/servicos/".concat(e.id),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:"Ver detalhes"})})]},e.id))})]}),(0,r.jsxs)("div",{className:"lg:col-span-3 relative",children:[(0,r.jsx)(m,{initialLocation:h||{lng:-47.9292,lat:-15.7801},markers:x,height:"100%",interactive:!0,zoom:12}),o&&(0,r.jsx)("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-white py-2 px-4 rounded-full shadow-md",children:(0,r.jsx)("p",{className:"text-secondary-600",children:"Carregando servi\xe7os..."})})]})]})})}a(7219),d().accessToken="pk.eyJ1IjoidXRhc2stYnIiLCJhIjoiY205N2k2emZkMDgwMTJqcGxldDEwNmRvMiJ9.YAYNOXMhaZMuWfDO8HVF3w"},8238:(e,t,a)=>{Promise.resolve().then(a.bind(a,2853))}},e=>{var t=t=>e(e.s=t);e.O(0,[168,6722,240,2108,6874,3568,7596,8441,1684,7358],()=>t(8238)),_N_E=e.O()}]);